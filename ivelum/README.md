# Hacker News Proxy

HTTP прокси-сервер для Hacker News с модификацией текста: добавление символа ™ после каждого слова из 6 букв.

## Описание

Прокси-сервер получает страницы с Hacker News, модифицирует текст и отображает их через свой адрес. При навигации по ссылкам браузер остается на адресе прокси.

## Реализация

### Архитектура

Проект организован по структуре, похожей на Go-проекты:

- `cmd/server/` - точка входа, FastAPI приложение
- `internal/proxy/` - обработка HTML, модификация ссылок
- `pkg/utils/` - утилиты (модификация текста)
- `configs/` - конфигурация

### Основные компоненты

**FastAPI приложение** (`cmd/server/main.py`):
- Проксирует все запросы к Hacker News
- Обрабатывает HTML контент
- Модифицирует ссылки для сохранения адреса прокси

**Обработка HTML** (`internal/proxy/processor.py`):
- Парсит HTML через BeautifulSoup
- Модифицирует текст: добавляет ™ после слов из 6 букв
- Заменяет ссылки на HN на ссылки прокси
- Обрабатывает формы

**Модификация текста** (`pkg/utils/text.py`):
- Использует регулярные выражения для поиска слов из 6 букв
- Добавляет ™ после найденных слов

### Как работает прокси

1. **Получение страницы**: Прокси делает HTTP GET запрос к Hacker News через библиотеку `httpx`:
   ```python
   response = await client.get('https://news.ycombinator.com/item?id=123')
   ```

2. **Модификация HTML**: Полученный HTML обрабатывается:
   - Текст: добавляется ™ после слов из 6 букв (регулярное выражение `\b([a-zA-Z]{6})\b`)
   - Ссылки: заменяются на ссылки прокси для сохранения адреса
   - Формы: action заменяется на прокси

3. **Возврат результата**: Модифицированный HTML возвращается браузеру. Браузер остается на адресе прокси, но видит контент с HN.

### Особенности реализации

1. **Модификация текста**: Регулярное выражение находит слова ровно из 6 букв и добавляет ™.

2. **Обработка ссылок**: Все относительные ссылки (`/item?id=123`) и ссылки на HN заменяются на ссылки прокси.

3. **Сохранение функциональности**: Скрипты и стили не модифицируются, только текстовый контент.

4. **Асинхронность**: Используется httpx для асинхронных запросов к HN.

## Технологии

- **Python 3.11+**
- **FastAPI** - веб-фреймворк
- **httpx** - асинхронные HTTP запросы
- **BeautifulSoup4** - парсинг HTML
- **lxml** - парсер для BeautifulSoup
- **Pytest** - тестирование

## Установка и запуск

### Локально

1. Установка зависимостей:
```bash
python3 -m venv venv
source venv/bin/activate
pip install -r requirements.txt
```

Или используйте скрипт:
```bash
./scripts/setup.sh
```

2. Запуск:
```bash
uvicorn cmd.server.main:app --host 127.0.0.1 --port 8232 --reload
```

Прокси доступен на http://127.0.0.1:8232

### Docker

```bash
docker-compose up --build
```

Прокси доступен на http://localhost:8232

## Использование

Откройте в браузере:
```
http://127.0.0.1:8232
```

Или конкретную страницу:
```
http://127.0.0.1:8232/item?id=13713480
```

Все ссылки на HN будут автоматически перенаправляться через прокси.

## Пример

**Оригинальный текст:**
```
The visual description of the colliding files
```

**Через прокси:**
```
The visual™ description™ of the colliding files
```

## Тестирование

```bash
pytest
```

С покрытием:
```bash
pytest --cov=cmd --cov=internal --cov=pkg --cov-report=html
```

## Структура проекта

```
ivelum/
├── cmd/server/main.py      # FastAPI приложение
├── internal/proxy/processor.py  # Обработка HTML
├── pkg/utils/text.py      # Модификация текста
├── configs/settings.py    # Конфигурация
├── tests/                 # Тесты
├── scripts/               # Скрипты
└── requirements.txt       # Зависимости
```

## Переменные окружения

- `HOST` - хост для запуска (по умолчанию 127.0.0.1)
- `PORT` - порт (по умолчанию 8232)
- `HN_BASE_URL` - базовый URL Hacker News (по умолчанию https://news.ycombinator.com)

## Postman коллекция

Для удобного тестирования создана коллекция Postman:
- `postman_collection.json` - коллекция для импорта в Postman
- `POSTMAN_REQUESTS.md` - описание всех запросов

## Дополнительно

- `Task.md` - описание задания
- `SCREEN.md` - скриншоты работающего приложения
